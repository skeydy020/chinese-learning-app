<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üìö Chinese Learning Chatbot</title>
  <link rel="stylesheet" href="style.css">
</head>

<body class="light">
  <div class="container">
    <div class="header">
      <h2>üìö Chinese Learning Chatbot</h2>
      <button class="theme-toggle-btn" id="themeToggle">üåó Toggle Theme</button>
    </div>

    <p>Enter a Chinese character or sentence below:</p>
    <textarea id="inputText" placeholder="Enter Chinese Words"></textarea>
    <button id="analyzeBtn" onclick="sendToGemini()">Analyze</button>

    <div id="response" class="response">Result will appear here...</div>
  </div>

  <script>
    const API_KEY = "AIzaSyA67H5mlTDEDNj73YGOPiIeh7MsLOPSYCY"; // üîë Replace with your actual Gemini API key

    document.getElementById("themeToggle").addEventListener("click", () => {
      document.body.classList.toggle("dark");
      document.body.classList.toggle("light");
    });

    function animateLoading(text, element) {
      let dotCount = 0;
      return setInterval(() => {
        dotCount = (dotCount + 1) % 4;
        element.textContent = text + '.'.repeat(dotCount);
      }, 500);
    }

    function formatResponse(text) {
      // Xo√° t·∫•t c·∫£ d·∫•u * v√† t√°ch d√≤ng
      const cleanText = text.replace(/\*/g, "");
      const lines = cleanText.split(/\n/).filter(line => line.trim() !== "");
      let html = "";

      for (let line of lines) {
        const sectionMatch = line.match(/^(\d+\.\s+)(.+)/);  // Gi·ªØ s·ªë th·ª© t·ª± (1. ...)
        if (sectionMatch) {
          const number = sectionMatch[1];      // "1. "
          const title = sectionMatch[2];       // "Pinyin"
          html += `<strong>${number}${title}</strong>`;
        } else {
          html += `<p>${line}</p>`;
        }
      }

      return html;
    }

    async function sendToGemini() {
      const input = document.getElementById("inputText").value.trim();
      const responseDiv = document.getElementById("response");

      if (!input) {
        responseDiv.textContent = "‚ö†Ô∏è Please enter a Chinese word or sentence.";
        return;
      }

      responseDiv.textContent = "";
      const loading = animateLoading("‚è≥ Analyzing", responseDiv);

      const prompt = `Analyze the following Chinese word or sentence: ${input}

Provide these details:
1. Pinyin
2. Sino-Vietnamese reading
3. Meaning
4. Structure / origin
5. Example usage

Respond only with the required details. No greetings or intro.
Use markdown style with **bold** section titles.`;

      try {
        const res = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-lite:generateContent?key=${API_KEY}`, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            contents: [{ parts: [{ text: prompt }] }]
          })
        });

        clearInterval(loading);
        const data = await res.json();
        const reply = data.candidates?.[0]?.content?.parts?.[0]?.text || "No response.";
        responseDiv.innerHTML = formatResponse(reply);
      } catch (err) {
        clearInterval(loading);
        responseDiv.textContent = "‚ö†Ô∏è Error: " + err.message;
      }
    }
  </script>
</body>

</html>